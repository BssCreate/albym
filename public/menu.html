<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ú–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</title>
    <style>

        * {
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π —Ñ–æ–Ω –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
        }

        /* 3. –û—Ç–∫–ª—é—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –¥–æ–ª–≥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ */
        * {
            user-select: none;          /* –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
            -webkit-user-select: none;  /* –î–ª—è Safari */
            -ms-user-select: none;      /* –î–ª—è —Å—Ç–∞—Ä—ã—Ö IE */
            -moz-user-select: none;     /* –î–ª—è Firefox */
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        img {
            pointer-events: none;       /* –û—Ç–∫–ª—é—á–∞–µ–º —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏ */
            -webkit-user-drag: none;    /* –û—Ç–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; height: 100vh; font-family: Arial, sans-serif; }
        .sidebar {
            width: 20%; background-color: #f4f4f4; padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .sidebar h2 { margin-bottom: 15px; }
        .sidebar ul { list-style: none; }
        .sidebar li {
            padding: 10px; margin-bottom: 10px;
            background-color: #fff; border-radius: 10px;
            cursor: pointer; transition: background 0.2s;
        }
        .sidebar li:hover { background-color: #f0f0f0; }
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        .dish {
            margin-bottom: 20px; padding: 15px;
            border: 1px solid #ddd; border-radius: 10px;
            display: flex; gap: 15px;
            cursor: pointer;
        }
        .dish img {
            width: 100px; height: 100px; border-radius: 10px;
            object-fit: cover;
        }
        .dish-info { flex: 1; }
        .dish-name { font-size: 20px; font-weight: bold; }
        .dish-description { margin: 10px 0; }
        .dish-meta { font-size: 14px; color: #555; }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal { 
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.5); 
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px;
            border-radius: 10px; width: 400px;
        }
        .modal-content img { width: 100%; }
        .modal-footer { display: flex; justify-content: space-between; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .btn-red { background-color: red; color: white; }
        .btn-green { background-color: green; color: white; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <ul id="categories"></ul>
    </div>
    <div class="content" id="content">
        <h1 id="category-title"></h1>
        <div id="dishes"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal" id="dishModal">
        <div class="modal-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑?</h2>
            <img id="modal-img" src="" alt="Dish image">
            <h3 id="modal-name"></h3>
            <p id="modal-description"></p>
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è –ø–∏—Ü—Ü—ã -->
            <div id="pizza-options" style="display: none;">
                <label for="size">–†–∞–∑–º–µ—Ä:</label>
                <select id="size" onchange="updateModalPriceAndWeight()">
                    <option value="30">30 —Å–º</option>
                    <option value="40">40 —Å–º (+300 ‚ÇΩ)</option>
                </select>
                <br>
                <label for="crust">–°—ã—Ä–Ω—ã–π –±–æ—Ä—Ç–∏–∫:</label>
                <select id="crust" onchange="updateModalPriceAndWeight()">
                    <option value="no">–ù–µ—Ç</option>
                    <option value="yes">–î–∞ (+50 ‚ÇΩ)</option>
                </select>
            </div>

            <!-- –ë–ª–æ–∫ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ—Å–∞ –∏ —Ü–µ–Ω—ã -->
            <div id="modal-weight-price">
                <p id="modal-weight-price-text">–í–µ—Å: –≥ ‚Ä¢ –¶–µ–Ω–∞: ‚ÇΩ</p>
            </div>

            <div id="final-price"></div>
            <div class="modal-footer">
                <button class="btn btn-green" id="addToOrder" onclick="addToOrder()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-red" onclick="closeModal()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>


    <script>
        let currentDish = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–ª—é–¥–∞
        let foodsData = {};

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function fetchFoods() {
            try {
                const response = await fetch('/foods.json');
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${response.status}`);
                }
                const data = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –±–ª—é–¥–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
                for (const category in data) {
                    data[category] = data[category].filter(dish => dish.price && dish.weight);
                }

                console.log('üì• –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
                return data;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ foods.json:', error);
                return {}; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
            }
        }



        function renderCategories() {
            const categoriesList = document.getElementById('categories');
            if (!foodsData || Object.keys(foodsData).length === 0) {
                console.warn('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π.');
                return;
            }

            categoriesList.innerHTML = Object.keys(foodsData).map(cat => 
                `<li onclick="renderDishes('${cat}')" id="category-${cat}">
                    <span>${cat}</span>
                </li>`
            ).join('');

            console.log('üì¶ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã.');
        }

        function renderDishes(category) {
            // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
            currentCategory = category;

            if (!foodsData[currentCategory]) {
                console.warn(`‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è "${category}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`);
                return;
            }

            const dishes = foodsData[currentCategory] || [];
            const dishesContainer = document.getElementById('dishes');
            document.getElementById('category-title').textContent = category;

            dishesContainer.innerHTML = dishes.map(dish => `
                <div class="dish" onclick="openModal('${dish.name}')">
                    <img src="${dish.image}" alt="${dish.name}" width="100">
                    <div>
                        <strong>${dish.name}</strong><br>
                        ${dish.description !== 'none' ? dish.description + "<br>" : ''}
                        <small>${dish.weight} –≥. ‚Ä¢ ${dish.price} ‚ÇΩ</small>
                    </div>
                </div>
            `).join('');

            console.log(`üçΩÔ∏è –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –±–ª—é–¥–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${category}"`);
        }


        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function openModal(dishName) {
            console.log('–ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –±–ª—é–¥–æ:', dishName);
            console.log('–¢–µ–∫—É—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:', currentCategory);

            // –ù–∞—Ö–æ–¥–∏–º –±–ª—é–¥–æ –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const dish = foodsData[currentCategory]?.find(d => d.name === dishName);

            if (dish) {
                currentDish = dish; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –±–ª—é–¥–æ
                document.getElementById('modal-img').src = dish.image;
                document.getElementById('modal-name').textContent = dish.name;
                document.getElementById('modal-description').textContent = dish.description !== 'none' ? dish.description : '';

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                basePrice = parseFloat(dish.price);
                baseWeight = parseInt(dish.weight);

                console.log('‚úîÔ∏è –û—Ç–∫—Ä—ã—Ç–æ –±–ª—é–¥–æ:', dish.name);
                console.log('–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞:', basePrice, '–ë–∞–∑–æ–≤—ã–π –≤–µ—Å:', baseWeight);

                if (currentCategory === '–ü–∏—Ü—Ü–∞') {
                    console.log('üçï –≠—Ç–æ –ø–∏—Ü—Ü–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏');
                    document.getElementById('pizza-options').style.display = 'block';
                    document.getElementById('size').value = 30;
                    document.getElementById('crust').value = 'no';
                } else {
                    console.log('ü•ó –≠—Ç–æ –Ω–µ –ø–∏—Ü—Ü–∞, —Å–∫—Ä—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏');
                    document.getElementById('pizza-options').style.display = 'none';
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                updateModalPriceAndWeight(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ currentDish
                document.getElementById('dishModal').style.display = 'flex';
            } else {
                console.error('‚ùå –ë–ª—é–¥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:', dishName);
            }
        }



        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –±–ª—é–¥
        function createDishCard(dish) {
            return `
                <div class="dish" onclick="openModal('${dish.name}')">
                    <img src="${dish.image}" alt="${dish.name}">
                    <div class="dish-info">
                        <div class="dish-name">${dish.name}</div>
                        ${dish.description !== 'none' ? `<div class="dish-description">${dish.description}</div>` : ''}
                        <div class="dish-meta">${dish.weight} –≥. ‚Ä¢ ${dish.price} ‚ÇΩ</div>
                    </div>
                </div>
            `;
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('dishModal').style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –≤–µ—Å–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function updateModalPriceAndWeight() {
            if (!currentDish) {
                console.error('‚ùå –û—à–∏–±–∫–∞: –æ–±—ä–µ–∫—Ç –±–ª—é–¥–∞ –Ω–µ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –≤ —Ñ—É–Ω–∫—Ü–∏—é');
                return;
            }

            let finalPrice = parseFloat(currentDish.price);
            let finalWeight = parseInt(currentDish.weight);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN
            if (isNaN(finalPrice) || isNaN(finalWeight)) {
                console.error('‚ö†Ô∏è –û—à–∏–±–∫–∞: —Ü–µ–Ω–∞ –∏–ª–∏ –≤–µ—Å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º.');
                return;
            }

            // –ï—Å–ª–∏ —ç—Ç–æ –ø–∏—Ü—Ü–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –¥–æ–ø. –æ–ø—Ü–∏–∏
            if (currentCategory === '–ü–∏—Ü—Ü–∞') {
                const size = document.getElementById('size').value;
                const crust = document.getElementById('crust').value;

                // –î–æ–ø–ª–∞—Ç–∞ –∑–∞ —Ä–∞–∑–º–µ—Ä 40 —Å–º
                if (size === "40") {
                    finalPrice += 300;
                    finalWeight += 350;
                }

                // –î–æ–ø–ª–∞—Ç–∞ –∑–∞ —Å—ã—Ä–Ω—ã–π –±–æ—Ä—Ç–∏–∫
                if (crust === "yes") {
                    finalPrice += 50;
                    finalWeight += 100;
                }
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤–µ—Å –≤ –∫–≥, –µ—Å–ª–∏ –æ–Ω –±–æ–ª—å—à–µ 999 –≥
            let weightText = finalWeight + " –≥";
            if (finalWeight >= 1000) {
                weightText = (finalWeight / 1000).toFixed(1) + " –∫–≥";
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –≤–µ—Å–∞ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
            const weightPriceText = `–í–µ—Å: ${weightText} ‚Ä¢ –¶–µ–Ω–∞: ${finalPrice} ‚ÇΩ`;
            document.getElementById('modal-weight-price-text').textContent = weightPriceText;
        }



        // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑"
        function addToOrder() {
            alert('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }


        let currentCategory = '';

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                foodsData = await fetchFoods();
                renderCategories();
                const categories = Object.keys(foodsData);
                if (categories.length > 0) {
                    renderDishes(categories[0]);
                }
            } catch (error) {
                console.error('üö´ –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
            }
        });

    </script>
</body>
</html>
